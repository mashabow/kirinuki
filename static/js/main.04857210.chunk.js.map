{"version":3,"sources":["components/AngleSlider.module.css","components/Canvas.module.css","components/App.module.css","features/crops.ts","features/sourceImage.ts","redux.ts","components/CropList.tsx","components/AngleSlider.tsx","components/DownloadButton.tsx","utils.ts","components/Sidebar.tsx","components/Canvas.tsx","components/Dropzone.tsx","components/App.tsx","hooks.ts","index.tsx","components/Sidebar.module.css","components/CropList.module.css","components/Dropzone.module.css"],"names":["module","exports","slice","createSlice","name","initialState","reducers","addCrop","state","action","push","payload","deleteCrop","splice","actions","fileName","url","angle","open","_","setAngle","rootReducer","combineReducers","crops","sourceImage","CropList","className","useSelector","dispatch","useDispatch","onDeleteIconClick","useCallback","index","classnames","styles","map","crop","i","key","Crop","Thumbnail","src","thumbnail","alt","DeleteIcon","type","onClick","formatter","toFixed","AngleSlider","hasImage","Boolean","onChange","value","disabled","min","max","step","defaultValue","tipFormatter","tooltipPlacement","DownloadButton","sourceImageFileName","s","json","JSON","stringify","substr","lastIndexOf","file","blobURL","URL","createObjectURL","link","document","createElement","href","download","click","revokeObjectURL","File","length","icon","previewClassName","Preview","Sidebar","PreviewWrapper","Canvas","cropperRef","undefined","useEffect","current","rotateTo","Cropper","ref","c","autoCropArea","preview","dragMode","toggleDragModeOnDblclick","Dropzone","children","useDropzone","accept","noClick","noKeyboard","onDrop","acceptedFiles","getRootProps","getInputProps","Root","Empty","image","Icon","description","Content","Layout","Sider","App","useRef","handler","event","a","cropper","getData","x","y","width","height","rotate","canvas","getCroppedCanvas","Promise","resolve","toBlob","blob","params","window","addEventListener","removeEventListener","useEnterToCrop","theme","store","configureStore","reducer","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.04857210.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"AngleSlider\":\"AngleSlider_AngleSlider__2SJUR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Cropper\":\"Canvas_Cropper__3Z3Jq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Sider\":\"App_Sider__3tFNd\"};","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\n// 各プロパティの意味は以下の図を参照\n// https://github.com/fengyuanchen/cropperjs/blob/v1.5.6/docs/images/data.jpg\ninterface CropParams {\n  readonly x: number;\n  readonly y: number;\n  readonly width: number;\n  readonly height: number;\n  readonly rotate: number;\n}\n\ninterface Crop {\n  readonly params: CropParams;\n  readonly thumbnail: string;\n}\n\nconst initialState: readonly Crop[] = [];\n\nconst slice = createSlice({\n  name: 'crops',\n  initialState,\n  reducers: {\n    addCrop: (state, action: PayloadAction<Crop>) => {\n      state.push(action.payload);\n    },\n    deleteCrop: (state, action: PayloadAction<number>) => {\n      state.splice(action.payload, 1);\n    },\n  },\n});\n\nexport default slice.reducer;\nexport const { addCrop, deleteCrop } = slice.actions;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\ninterface State {\n  readonly fileName: string | null;\n  readonly url: string | null;\n  readonly angle: number;\n}\n\nconst initialState: State = {\n  fileName: null,\n  url: null,\n  angle: 0,\n};\n\nconst slice = createSlice({\n  name: 'sourceImage',\n  initialState,\n  reducers: {\n    open: (_, action: PayloadAction<Pick<State, 'fileName' | 'url'>>) => {\n      return {\n        ...action.payload,\n        angle: initialState.angle,\n      };\n    },\n    setAngle: (state, action: PayloadAction<number>) => {\n      state.angle = action.payload;\n    },\n  },\n});\n\nexport default slice.reducer;\nexport const { open, setAngle } = slice.actions;\n","import { combineReducers } from 'redux';\n\nimport crops from './features/crops';\nimport sourceImage from './features/sourceImage';\n\nconst rootReducer = combineReducers({\n  crops,\n  sourceImage,\n});\n\nexport default rootReducer;\n\n// useSelector を型付けする\ndeclare module 'react-redux' {\n  interface DefaultRootState extends ReturnType<typeof rootReducer> {}\n}\n","import classnames from 'classnames';\nimport React, { useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport styles from './CropList.module.css';\nimport { Icon } from 'antd';\nimport { deleteCrop } from '../features/crops';\n\ninterface Props {\n  readonly className?: string;\n}\n\nconst CropList: React.FC<Props> = ({ className }) => {\n  const crops = useSelector(state => state.crops);\n\n  const dispatch = useDispatch();\n  const onDeleteIconClick = useCallback(\n    (index: number) => () => {\n      dispatch(deleteCrop(index));\n    },\n    [dispatch],\n  );\n\n  return (\n    <div className={classnames(className, styles.CropList)}>\n      {crops.map((crop, i) => (\n        <div key={i} className={styles.Crop}>\n          <img className={styles.Thumbnail} src={crop.thumbnail} alt=\"\" />\n          <Icon\n            className={styles.DeleteIcon}\n            type=\"delete\"\n            onClick={onDeleteIconClick(i)}\n          />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default CropList;\n","import { Slider } from 'antd';\nimport { SliderValue } from 'antd/lib/slider';\nimport React, { useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { setAngle } from '../features/sourceImage';\n\nimport styles from './AngleSlider.module.css';\n\nconst formatter = (angle: number) => `${angle.toFixed(1)}°`;\n\nconst AngleSlider: React.FC = () => {\n  const hasImage = useSelector(state => Boolean(state.sourceImage.url));\n\n  const dispatch = useDispatch();\n  const onChange = useCallback(\n    (value: SliderValue) => {\n      if (typeof value === 'number') {\n        dispatch(setAngle(value));\n      }\n    },\n    [dispatch],\n  );\n\n  return (\n    <Slider\n      className={styles.AngleSlider}\n      disabled={!hasImage}\n      min={-10}\n      max={10}\n      step={0.1}\n      defaultValue={0}\n      onChange={onChange}\n      tipFormatter={formatter}\n      tooltipPlacement=\"bottom\"\n    />\n  );\n};\n\nexport default AngleSlider;\n","import { Button } from 'antd';\nimport React, { useCallback } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { basename, download } from '../utils';\n\nconst DownloadButton = () => {\n  const crops = useSelector(state => state.crops);\n  const sourceImageFileName = useSelector(state => state.sourceImage.fileName);\n\n  const onClick = useCallback(() => {\n    const json = JSON.stringify(crops, null, 2);\n    const fileName = `${basename(sourceImageFileName!)}.json`;\n    download(new File([json], fileName, { type: 'application/json' }));\n  }, [crops, sourceImageFileName]);\n\n  return (\n    <Button\n      disabled={!crops.length}\n      type=\"primary\"\n      icon=\"download\"\n      onClick={onClick}\n    >\n      ダウンロード\n    </Button>\n  );\n};\n\nexport default DownloadButton;\n","export const basename = (s: string): string => s.substr(0, s.lastIndexOf('.'));\n\nexport const download = (file: File): void => {\n  const blobURL = URL.createObjectURL(file);\n\n  const link = document.createElement('a');\n  link.href = blobURL;\n  link.download = file.name;\n  link.click();\n\n  URL.revokeObjectURL(blobURL);\n};\n","import React from 'react';\n\nimport CropList from './CropList';\nimport AngleSlider from './AngleSlider';\nimport DownloadButton from './DownloadButton';\nimport styles from './Sidebar.module.css';\n\nexport const previewClassName = styles.Preview;\n\nconst Sidebar = () => {\n  return (\n    <div className={styles.Sidebar}>\n      <AngleSlider />\n      {/* プレビュー領域の高さを固定するためにはラッパーが必要 */}\n      <div className={styles.PreviewWrapper}>\n        <div className={styles.Preview} />\n      </div>\n      <CropList className={styles.CropList} />\n      <DownloadButton />\n    </div>\n  );\n};\n\nexport default Sidebar;\n","import React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Cropper from 'react-cropper';\nimport 'cropperjs/dist/cropper.css';\n\nimport styles from './Canvas.module.css';\n\ninterface Props {\n  readonly cropperRef: React.MutableRefObject<Cropper | null>;\n  readonly previewClassName: string;\n}\n\nconst Canvas = ({ cropperRef, previewClassName }: Props) => {\n  const src = useSelector(state => state.sourceImage.url ?? undefined);\n\n  const dispatch = useDispatch();\n  const angle = useSelector(state => state.sourceImage.angle);\n  useEffect(() => {\n    if (cropperRef.current) {\n      cropperRef.current.rotateTo(angle);\n    }\n  }, [angle, cropperRef, dispatch]);\n\n  return (\n    <Cropper\n      className={styles.Cropper}\n      ref={c => {\n        cropperRef.current = c;\n      }}\n      src={src}\n      // Cropper.js options\n      autoCropArea={0.2}\n      preview={`.${previewClassName}`}\n      dragMode=\"move\"\n      toggleDragModeOnDblclick={false}\n    />\n  );\n};\n\nexport default Canvas;\n","import React from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { open } from '../features/sourceImage';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Empty, Icon } from 'antd';\n\nimport styles from './Dropzone.module.css';\n\ninterface Props {\n  readonly children: React.ReactElement;\n}\n\nconst Dropzone = ({ children }: Props) => {\n  const hasImage = useSelector(state => Boolean(state.sourceImage.url));\n\n  const dispatch = useDispatch();\n  const { getRootProps, getInputProps } = useDropzone({\n    accept: ['image/jpeg', 'image/png'],\n    noClick: hasImage,\n    noKeyboard: true,\n    onDrop: acceptedFiles => {\n      const file = acceptedFiles[0];\n      if (!acceptedFiles) return;\n      const blobURL = URL.createObjectURL(file);\n      dispatch(open({ fileName: file.name, url: blobURL }));\n    },\n  });\n\n  return (\n    <div className={styles.Root} {...getRootProps()}>\n      <input {...getInputProps()} />\n      {hasImage ? (\n        children\n      ) : (\n        <Empty\n          className={styles.Empty}\n          image={<Icon type=\"file-image\" className={styles.Icon} />}\n          description=\"ここをクリック or ドロップして画像を開く\"\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Dropzone;\n","import { Layout } from 'antd';\nimport React, { useRef } from 'react';\nimport Cropper from 'react-cropper';\n\nimport { useEnterToCrop } from '../hooks';\nimport Sidebar, { previewClassName } from './Sidebar';\nimport Canvas from './Canvas';\nimport Dropzone from './Dropzone';\nimport styles from './App.module.css';\n\nconst { Content, Sider } = Layout;\n\nconst App = () => {\n  const cropperRef = useRef<Cropper | null>(null);\n  useEnterToCrop(cropperRef);\n\n  return (\n    <Layout>\n      <Content>\n        <Dropzone>\n          <Canvas cropperRef={cropperRef} previewClassName={previewClassName} />\n        </Dropzone>\n      </Content>\n      <Sider width={320} className={styles.Sider} theme=\"light\">\n        <Sidebar></Sidebar>\n      </Sider>\n    </Layout>\n  );\n};\n\nexport default App;\n","import { useEffect, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { addCrop } from './features/crops';\n\nexport const useEnterToCrop = (\n  cropperRef: React.MutableRefObject<Cropper | null>,\n): void => {\n  const dispatch = useDispatch();\n  const handler = useCallback(\n    async (event: KeyboardEvent) => {\n      const cropper = cropperRef.current;\n      if (cropper && event.key === 'Enter') {\n        const { x, y, width, height, rotate } = cropper.getData();\n        const canvas = cropper.getCroppedCanvas({\n          // サムネイルで表示する領域の数倍のサイズにしておかないと、画質が落ちてしまう\n          width: 300,\n          height: 300,\n        });\n        const blob = await new Promise(resolve => canvas.toBlob(resolve));\n\n        dispatch(\n          addCrop({\n            params: { x, y, width, height, rotate },\n            thumbnail: URL.createObjectURL(blob),\n          }),\n        );\n      }\n    },\n    [cropperRef, dispatch],\n  );\n\n  useEffect(() => {\n    window.addEventListener('keydown', handler);\n    return () => window.removeEventListener('keydown', handler);\n  }, [handler]);\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { configureStore } from '@reduxjs/toolkit';\nimport { Provider } from 'react-redux';\nimport reducer from './redux';\nimport App from './components/App';\n\nimport 'antd/dist/antd.css';\nimport './index.css';\n\nconst store = configureStore({\n  reducer,\n});\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root'),\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Sidebar\":\"Sidebar_Sidebar__c0TTh\",\"PreviewWrapper\":\"Sidebar_PreviewWrapper__3yT_p\",\"Preview\":\"Sidebar_Preview__3edd7\",\"CropList\":\"Sidebar_CropList__2dT_-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"CropList\":\"CropList_CropList__HvDYP\",\"Crop\":\"CropList_Crop__2OCZE\",\"Thumbnail\":\"CropList_Thumbnail__3bha8\",\"DeleteIcon\":\"CropList_DeleteIcon__1tKMW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Root\":\"Dropzone_Root__oZIIO\",\"Empty\":\"Dropzone_Empty__kL6cb\",\"Icon\":\"Dropzone_Icon__qVqCp\"};"],"sourceRoot":""}